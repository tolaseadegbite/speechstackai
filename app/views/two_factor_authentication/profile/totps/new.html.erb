<%= turbo_frame_tag "settings_content" do %>
  <div class="p-4">

    <%# --- MOBILE-ONLY BACK BUTTON --- %>
    <%= render "shared/settings_back_button" %>

    <div class="max-i-full" style="max-width: 48rem;">
      <% if Current.user.otp_required_for_sign_in? %>
        <h1 class="font-bold text-2xl mbe-4">Replace your 2FA setup?</h1>
        <p class="text-subtle mbe-2">Your account is already protected with two-factor authentication. You can replace that setup if you want to switch to a new phone or authenticator app.</p>
        <p class="font-medium mbe-4">This will invalidate your existing 2FA setup. Do you want to continue?</p>
        <%= button_to "Yes, replace my 2FA setup", two_factor_authentication_profile_totp_path, method: :patch, class: "btn mbe-8" %>
        <div class="border-b border-main mbe-8"></div>
      <% end %>

      <h1 class="font-bold text-2xl mbe-4">Upgrade your security with 2FA</h1>

      <div class="mbe-6">
        <h2 class="font-semibold text-lg mbe-2">Step 1: Get an Authenticator App</h2>
        <p class="text-subtle">First, you'll need a 2FA authenticator app on your phone. If you already have one, skip to step 2. We recommend an app like Google Authenticator or Microsoft Authenticator.</p>
      </div>

      <div class="mbe-6">
        <h2 class="font-semibold text-lg mbe-2">Step 2: Scan + Enter the Code</h2>
        <p class="text-subtle mbe-4">Next, open the authenticator app, tap "Scan QR code" or "+", and point your phone's camera at this QR code picture below.</p>

        <figure class="flex flex-col items-center gap-half bg-white p-4 rounded-lg inline-block mi-auto">
          <%= image_tag @qr_code.as_png(resize_exactly_to: 200).to_data_url %>
          <figcaption class="text-xs text-subtle">Point your camera here</figcaption>
        </figure>
      </div>

      <%= form_with(url: two_factor_authentication_profile_totp_path) do |form| %>
        <div class="flex flex-col items-start gap-half mbe-4">
          <%= form.label :code, "After scanning, the app will generate a six-digit code. Enter it here:", class: "text-sm font-medium leading-none" %>
          <%= form.text_field :code, required: true, autofocus: true, autocomplete: :off, class: "input" %>
        </div>

        <div class="inline-flex items-center gap-2 mbs-4">
          <%= form.submit "Verify and activate", class: "btn btn--primary", data: { turbo_frame: "_top" } %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>