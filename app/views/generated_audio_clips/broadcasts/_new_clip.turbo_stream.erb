<% date = audio.created_at.to_date %>
<% is_first_of_the_day = audio.user.generated_audio_clips.where("DATE(created_at) = ?", date).count == 1 %>

<% [:desktop, :mobile].each do |context| %>

  <% if is_first_of_the_day %>
    <%= turbo_stream.prepend "history_list_#{context}" do %>
      <%= render partial: "layouts/shared/history_date_group", 
                 locals: { date: date, audio_clips: [audio], context: context } %>
    <% end %>
  <% else %>
    <%= turbo_stream.prepend "#{context}_history_items_for_#{date.to_s}" do %>
      <%= render partial: "layouts/shared/history_item", 
                 locals: { audio: audio, context: context } %>
    <% end %>
  <% end %>

<% end %>