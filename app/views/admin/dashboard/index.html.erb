<% content_for :title, "Admin" %>
<% content_for :page_header, "Admin Dashboard" %>

<div class="p-4">
  <!-- Stats Grid -->
  <div class="grid grid-cols-1 grid-cols-3@md gap-4 mbe-8">
    <div class="bg-surface border rounded-lg p-6">
      <p class="text-sm text-subtle uppercase font-bold">Total Users</p>
      <p class="text-4xl font-bold"><%= @total_users %></p>
    </div>
    
    <div class="bg-surface border rounded-lg p-6">
      <p class="text-sm text-subtle uppercase font-bold">Audio Clips Generated</p>
      <p class="text-4xl font-bold"><%= @total_clips %></p>
    </div>
    
    <div class="bg-surface border rounded-lg p-6">
      <p class="text-sm text-subtle uppercase font-bold">Credits in Circulation</p>
      <p class="text-4xl font-bold"><%= @total_credits %></p>
    </div>
  </div>

  <div class="grid grid-cols-1 grid-cols-2@lg gap-8">
    <!-- Recent Users -->
    <div>
      <h3 class="font-bold text-lg mbe-4">Recent Signups</h3>
      <div class="bg-surface border rounded-lg overflow-hidden">
        <% @latest_users.each do |user| %>
          <div class="p-3 border-be flex justify-between items-center" style="<%= 'border-bottom: 0;' if user == @latest_users.last %>">
            <div>
              <p class="font-medium"><%= user.name %></p>
              <p class="text-xs text-subtle"><%= user.email %></p>
            </div>
            <span class="text-xs font-medium bg-shade text-subtle pi-2 pb-1 rounded-md">
              <%= user.created_at.to_date %>
            </span>
          </div>
        <% end %>
        
        <% if @latest_users.empty? %>
          <div class="p-4 text-center text-subtle">No recent signups.</div>
        <% end %>
      </div>
    </div>

    <!-- Recent Clips -->
    <div>
      <div class="flex gap-2 items-center mbe-4">
        <h3 class="font-bold text-lg">Recent Generations</h3> 
        <%= link_to "View all", admin_generated_audio_clips_path, class: "btn text-sm pi-2 pb-1" %>
      </div>

      <div class="bg-surface border rounded-lg overflow-hidden">
        <% @latest_clips.each do |clip| %>
          <div class="p-3 border-be flex justify-between items-center" style="<%= 'border-bottom: 0;' if clip == @latest_clips.last %>">
            <div class="min-i-0">
              <p class="font-medium overflow-ellipsis whitespace-nowrap" style="max-inline-size: 20rem;">
                <%= clip.text %>
              </p>
              <p class="text-xs text-subtle">
                <%= clip.type.underscore.humanize %> by <%= clip.user.first_name %>
              </p>
            </div>
            
            <% if clip.failed? %>
              <span class="text-xs font-medium bg-red-100 text-red-800 pi-2 pb-1 rounded-md">
                <%= clip.status %>
              </span>
            <% else %>
              <span class="text-xs font-medium bg-green-100 text-green-800 pi-2 pb-1 rounded-md">
                <%= clip.status %>
              </span>
            <% end %>
          </div>
        <% end %>

        <% if @latest_clips.empty? %>
          <div class="p-4 text-center text-subtle">No recent generations.</div>
        <% end %>
      </div>
    </div>
  </div>
</div>