<%= tag.div class: "flex justify-between items-center voice-list-item text-start p-2", id: dom_id(audio) do %>
  <div class="flex flex-col gap-half text-sm">

    <div contents data-controller="popover" data-action="mouseenter->popover#debouncedShow mouseleave->popover#debouncedHide" data-popover-placement-value="bottom-right">

      <a href="" class="" data-popover-target="trigger">
        <h4 class="overflow-ellipsis font-semibold"><%= audio.text.truncate(40) %></h4>
      </a>

      <div popover="hint" class="popover shadow-md" style="max-width: 20rem;" data-popover-target="content" role="dialog">
        <div class="flex flex-col p-4">
          <p class="text-sm text-subtle"><%= audio.text %></p>
        </div>
      </div>
    </div>

    <div class="flex items-center gap-2 text-sm text-subtle">
      <span class="voice-swatch shrink-0" style="--icon-size: 1rem; <%= voice_gradient_style(audio.voice) %>" aria-hidden="true"></span>
      <span><%= audio.voice.name %> Â· <%= audio.created_at.strftime('%I:%M %p') %></span>
    </div>
  </div>

  <div class="flex items-center gap-4 shrink-0 mis-2">
    <% s3_url = presigned_s3_url(audio.s3_key) %>
    <button type="button" class="btn btn--icon btn--subtle"
                            data-action="audio-player#play"
                            data-audio-player-url-param="<%= s3_url %>"
                            data-audio-player-title-param="<%= audio.text.truncate(40) %>"
                            data-audio-player-author-param="<%= audio.voice.name %>"
                            data-audio-player-filename-param="<%= "audio_#{audio.id}.mp3" %>"
                            data-audio-player-gradient-start-param="<%= audio.voice.gradient_start %>"
                            data-audio-player-gradient-end-param="<%= audio.voice.gradient_end %>">
      
      <%# --- FIX: Replace the span with the targetable div structure --- %>
      <div data-play-icon-url="<%= s3_url %>">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>
      </div>
    </button>
    
    <a href="<%= s3_url %>" download="<%= "audio_#{audio.id}.mp3" %>" class="btn btn--icon btn--subtle cursor-pointer">
      <span class="icon icon--download" aria-hidden="true"></span>
    </a>
  </div>
<% end %>