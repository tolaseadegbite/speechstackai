<% content_for :title, "User Feedbacks" %>
<% content_for :page_header, "User Feedbacks" %>

<div class="i-full p-4 mi-auto" style="max-width: 90rem;">
  <div class="flex items-center justify-between mbe-4">
    <h1 class="font-bold text-2xl">Feedback Submissions</h1>

    <%= link_to "New Feedback", new_feedback_path,
                class: "btn btn--primary",
                data: { turbo_frame: "modal" } %>
  </div>

  <%# --- Filter Links --- %>
  <div class="flex flex-wrap items-center gap-2 mbe-4">
    <strong class="text-sm font-semibold mr-2">Filter by:</strong>
    
    <%# Service Filters %>
    <div class="flex items-center gap-1 border-r border-main pr-3 mr-1">
      <span class="text-xs text-subtle mr-1">Service:</span>
      <%= link_to "All", feedbacks_path(request.query_parameters.except(:service, :page)), class: "btn btn--subtle text-xs #{'bg-primary-container text-primary' unless params[:service].present?}" %>
      <% Feedback.services.each_key do |service| %>
        <%= filter_link(service.humanize, :service, service) %>
      <% end %>
    </div>
    
    <%# Feedback Type Filters %>
    <div class="flex flex-wrap items-center gap-1">
      <span class="text-xs text-subtle mr-1">Type:</span>
      <%= link_to "All", feedbacks_path(request.query_parameters.except(:feedback_type, :page)), class: "btn btn--subtle text-xs #{'bg-primary-container text-primary' unless params[:feedback_type].present?}" %>
      <% Feedback.feedback_types.each_key do |type| %>
        <%= filter_link(type.humanize, :feedback_type, type) %>
      <% end %>
    </div>
  </div>
  <%# --- End of Filter Links --- %>


  <% if @feedbacks.any? %>
    <%= content_tag(:"turbo-frame", id: "feedbacks", target: "_top", class: "grid grid-cols-1 grid-cols-2@sm grid-cols-2@md grid-cols-3@lg gap-4") do %>
      <%= render partial: "feedbacks/feedback", collection: @feedbacks, as: :feedback %>
    <% end %>

    <%= render_load_more(@pagy) %>
    
  <% else %>
      <div class="text-center p-8 bg-surface border border-dashed rounded-lg">
        <h3 class="text-lg font-medium">No Matching Feedback</h3>
        <p class="text-subtle mt-1">
          No feedback submissions match the selected filters.
          <%= link_to "Clear all filters", feedbacks_path, class: "text-primary font-semibold underline" %>
        </p>
      </div>
  <% end %>
</div>